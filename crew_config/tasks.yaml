# Game Development Tasks

review_ecs_layer:
  description: >
    Review the completed ECS data layer implementation including:
    - Species data for 13 predators + 15 prey with complete stats
    - Component initializers (Combat, Movement, AI, Equipment, Animation)
    - Entity factories (createPredator, createPrey, createBiomeResource)
    - Attack normalization helpers
    - Type safety (0 TypeScript errors achieved)
    
    Verify:
    - No shared array references (all deep-copied)
    - Component initializers honor caller inputs
    - Attack validation is strict
    - Architecture follows ARCHITECTURE.md 3-layer pattern
  expected_output: >
    Detailed review report with:
    - Architecture assessment (passes/fails)
    - Type safety validation results
    - Any critical issues blocking next phase
    - Approval to proceed OR required fixes
  agent: chief_architect

implement_yuka_sync:
  description: >
    Implement YukaSyncSystem to bridge ECS entities to Yuka vehicles:
    - Watch for new entities with Movement + AI components
    - Create corresponding Yuka Vehicle instances
    - Sync position/rotation from ECS to Yuka every frame
    - Update ECS components with Yuka's steering output
    - Handle entity removal (destroy vehicles)
    
    Integration points:
    - client/src/ai/yukaManager.ts (already scaffolded)
    - client/src/ecs/systems/YukaSyncSystem.ts (create new)
    - Hook into main game loop via useFrame
  expected_output: >
    Complete YukaSyncSystem implementation with:
    - Type-safe entity-to-vehicle mapping
    - Bidirectional ECSâ†”Yuka sync
    - Proper cleanup on entity destruction
    - Integration with existing yukaManager
  agent: yuka_ai_engineer
  context: [review_ecs_layer]

implement_core_systems:
  description: >
    Implement the following ECS systems:
    
    1. TimeSystem - manages day/night cycle (0.0-1.0), time progression
    2. WeatherSystem - handles weather states (clear/rain/fog/storm), transitions
    3. SpawnSystem - spawns creatures based on biome, time, weather
    4. CombatSystem - resolves attacks, applies damage, handles knockback/stun
    
    Each system should:
    - Operate on ECS components via Miniplex queries
    - Be pure functions (no side effects beyond component updates)
    - Integrate with global game state (Zustand)
    - Support pausing/resuming
  expected_output: >
    Four complete system implementations in client/src/ecs/systems/:
    - TimeSystem.ts
    - WeatherSystem.ts  
    - SpawnSystem.ts
    - CombatSystem.ts
    
    Each with proper TypeScript types and ECS integration.
  agent: systems_engineer
  context: [review_ecs_layer, implement_yuka_sync]

create_combat_tests:
  description: >
    Create TDD tests for combat balance validation:
    - Attack damage calculations (including level scaling)
    - Stamina consumption and regeneration
    - Knockback and stun duration mechanics
    - Combat between different species (predator vs prey)
    - Edge cases (zero stamina, multiple attackers)
    
    Use Vitest framework. Tests should fail if combat balance is broken.
  expected_output: >
    Test suite at client/src/ecs/systems/__tests__/CombatSystem.test.ts with:
    - At least 15 test cases covering combat mechanics
    - Validation of all attack properties
    - Balance checks for predator/prey matchups
    - All tests passing
  agent: qa_tester
  context: [implement_core_systems]

validate_integration:
  description: >
    Final integration validation:
    - Run full TypeScript compilation (must be 0 errors)
    - Execute all test suites
    - Verify ECS systems integrate cleanly
    - Check that Yuka sync doesn't cause performance issues
    - Validate mobile performance targets (if possible)
    
    Document any issues or warnings that need attention.
  expected_output: >
    Integration report with:
    - TypeScript compilation status
    - Test suite results (pass/fail counts)
    - Performance observations
    - Final approval OR blocker list
  agent: qa_tester
  context: [create_combat_tests]

final_architecture_review:
  description: >
    Chief architect's final review of all implementations:
    - ECS layer integrity
    - Yuka AI integration quality
    - Core systems completeness
    - Test coverage adequacy
    - Alignment with replit.md specifications
    
    Provide final approval or request specific revisions.
  expected_output: >
    Final architectural decision:
    - APPROVED: Ready to proceed to rendering phase
    - REVISE: Specific changes required before approval
    
    Include summary of what was accomplished and next recommended steps.
  agent: chief_architect
  context: [validate_integration]
