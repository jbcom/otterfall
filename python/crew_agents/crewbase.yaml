
# Rivermarsh Game Development Crew
# Uses native CrewAI MCP DSL (reads from .mcp.json generated by Ruler)

crew:
  name: "rivermarsh_dev_crew"
  process: hierarchical
  manager:
    llm:
      provider: openai
      config:
        model: "openrouter/auto"
        base_url: "https://openrouter.ai/api/v1"
        api_key: ${OPENROUTER_API_KEY}
    verbose: true
    memory: true

agents:
  - name: technical_director
    role: "Technical Director & Workflow Coordinator"
    goal: "Orchestrate the Alpha→Work→Omega workflow ensuring ConPort context is consulted and updated"
    backstory: |
      You coordinate the development team with a strict workflow pattern:
      1. ALPHA: Consult Project Manager for context analysis
      2. WORK: Delegate to specialist agents (ECS, AI, rendering, etc.)
      3. OMEGA: Have Technical Writer record all progress in ConPort
      
      You ensure every task follows this pattern and maintain alignment with ConPort's project context.
    allow_delegation: true
    verbose: true
    memory: true
    max_iter: 40
    tools:
      - mcp://conport/*
      - mcp://git/*
      - mcp://github/*
      - mcp://filesystem/*
      - mcp://memory/*

  - name: project_manager
    role: "Project Manager (Alpha Agent - Context Reader)"
    goal: "Analyze projectbrief.md and ConPort context to determine task scope, dependencies, and blockers"
    backstory: |
      You start every workflow by reading complete project context from ConPort.
      You identify missing information, blockers, dependencies, and required resources.
      READ-ONLY ConPort access - report findings to Technical Director.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 30
    tools:
      - mcp://conport/get_product_context
      - mcp://conport/get_active_context
      - mcp://conport/get_recent_activity_summary
      - mcp://conport/get_decisions
      - mcp://conport/get_progress
      - mcp://filesystem/read_file
      - mcp://git/status
      - mcp://git/log

  - name: technical_writer
    role: "Technical Writer (Omega Agent - Context Writer)"
    goal: "Record all decisions, progress, patterns, and context into ConPort for future AI agents"
    backstory: |
      You end every workflow by updating ConPort with decisions, progress, and patterns.
      Full READ-WRITE ConPort access to maintain project's institutional memory.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 30
    tools:
      - mcp://conport/*
      - mcp://filesystem/read_file
      - mcp://filesystem/write_file

  - name: ecs_architect
    role: "ECS & Data Architecture Lead"
    goal: "Design and maintain type-safe ECS systems using Miniplex with zero runtime errors"
    backstory: |
      You specialize in Entity Component System design with Miniplex, TypeScript, and game architecture.
      You build scalable, performant systems with clean separation of concerns.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 25
    tools:
      - mcp://filesystem/read_file
      - mcp://filesystem/write_file
      - mcp://filesystem/list_directory
      - mcp://context7/fetch_library_docs

  - name: yuka_ai_engineer
    role: "AI Systems Engineer (Yuka Specialist)"
    goal: "Implement creature AI behaviors using Yuka steering behaviors and state machines"
    backstory: |
      You build believable AI systems using Yuka.js steering behaviors, state machines, and GOAP.
      You bridge Yuka entities with R3F/Three.js and optimize for 60fps on mobile.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 25
    tools:
      - mcp://filesystem/read_file
      - mcp://filesystem/write_file
      - mcp://playwright/run_test
      - mcp://git/diff
      - mcp://context7/fetch_library_docs

  - name: rendering_engineer
    role: "3D Graphics & Rendering Engineer"
    goal: "Build beautiful, performant React Three Fiber scenes with custom shaders"
    backstory: |
      You create stunning R3F/Three.js visuals with GLSL shaders while maintaining 60fps on mobile.
      You use instancing, LOD, GPU culling, and SDF raymarching.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 25
    tools:
      - mcp://filesystem/read_file
      - mcp://filesystem/write_file
      - mcp://vite-react/dev_server
      - mcp://playwright/run_test
      - mcp://context7/fetch_library_docs

  - name: systems_engineer
    role: "Game Systems Engineer"
    goal: "Implement game mechanics: quests, dialogue, inventory, combat, progression"
    backstory: |
      You build core gameplay loops with quest systems, dialogue trees, inventory, and combat.
      You integrate with ECS architectures for mobile performance.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 25
    tools:
      - mcp://filesystem/read_file
      - mcp://filesystem/write_file
      - mcp://memory/store_knowledge
      - mcp://memory/retrieve_knowledge
      - mcp://context7/fetch_library_docs

  - name: dfu_analyst
    role: "Daggerfall Unity Data Analyst"
    goal: "Parse and map Daggerfall Unity data files to Rivermarsh natural world species"
    backstory: |
      You extract legacy game data and adapt fantasy RPG mechanics to realistic natural simulations.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 25
    tools:
      - mcp://filesystem/read_file
      - mcp://filesystem/write_file
      - mcp://filesystem/list_directory

  - name: qa_tester
    role: "Quality Assurance & Performance Engineer"
    goal: "Ensure 60fps on mobile, zero TypeScript errors, and comprehensive test coverage"
    backstory: |
      You use Playwright for testing, validate TypeScript, and profile performance.
      You ensure 60fps on mobile and catch bugs before production.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 20
    tools:
      - mcp://filesystem/read_file
      - mcp://playwright/run_test
      - mcp://git/status
      - mcp://git/diff

  - name: chief_architect
    role: "Chief Architect & Documentation Lead"
    goal: "Maintain architectural vision, keep documentation current, and ensure team alignment"
    backstory: |
      You maintain the big picture, ensure code follows documented architecture,
      and use Context7 to prevent AI hallucinations with up-to-date docs.
    allow_delegation: false
    verbose: true
    memory: true
    max_iter: 30
    tools:
      - mcp://conport/*
      - mcp://filesystem/*
      - mcp://git/*
      - mcp://context7/*

tasks:
  - name: context_analysis
    description: |
      ALPHA TASK: Read ConPort context before any work begins.
      
      1. Use get_conport_schema to understand available tools
      2. Read projectbrief.md from ConPort custom data
      3. Fetch product context, active context, recent activity
      4. Analyze MACRO (repo), MESO (component), MICRO (task) levels
      5. Identify blockers, dependencies, missing information
      6. Recommend task sequencing and required resources
    expected_output: "Context analysis report with blockers, dependencies, and recommended sequence"
    agent: project_manager

  - name: ecs_data_design
    description: |
      Review and enhance ECS data layer in client/src/ecs/.
      Ensure component types are correct, species data complete, entity factories follow best practices.
    expected_output: "TypeScript files with zero errors, complete species taxonomy, proper component initializers"
    agent: ecs_architect

  - name: yuka_ai_integration
    description: |
      Implement Yuka AI integration for creature behaviors.
      Set up YukaSyncSystem, create steering behaviors, implement state machines.
    expected_output: "Working Yuka AI system with smooth creature behaviors synced with R3F rendering"
    agent: yuka_ai_engineer

  - name: terrain_water_rendering
    description: |
      Build chunked terrain with LOD and procedural generation.
      Implement AdvancedWater with Gerstner waves, caustics, depth color.
      Add post-processing effects. Target 60fps on mobile.
    expected_output: "Beautiful performant marshland with advanced water shaders at 60fps on mobile"
    agent: rendering_engineer

  - name: quest_dialogue_systems
    description: |
      Implement quest system with JSON data and progression tracking.
      Build dialogue tree system and inventory management.
    expected_output: "Working quest, dialogue, and inventory systems integrated with game UI"
    agent: systems_engineer

  - name: performance_testing
    description: |
      Run Playwright tests, profile rendering performance, validate TypeScript types.
      Test on simulated mobile devices for 60fps target.
    expected_output: "Performance report, passing test suite, clean TypeScript validation"
    agent: qa_tester

  - name: architecture_review
    description: |
      Review all code changes against ConPort product context.
      Use Context7 for latest docs. Provide final approval or revision requests.
    expected_output: "Architecture compliance report, final approval or revision requests"
    agent: chief_architect

  - name: context_recording
    description: |
      OMEGA TASK: Record all work into ConPort after task completion.
      
      1. Log decisions with rationale and implementation details
      2. Update progress entries to "completed"
      3. Record new system patterns discovered
      4. Link related ConPort items in knowledge graph
      5. Update product/active context if architecture changed
    expected_output: "Complete ConPort update with decisions, progress, patterns, and knowledge graph links"
    agent: technical_writer
